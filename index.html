<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AyuAI - Clinical Risk Prediction Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        },
                        clinical: {
                            bg: '#f8fafc',
                            surface: '#ffffff',
                            border: '#e2e8f0',
                            text: '#0f172a',
                            muted: '#64748b'
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #f8fafc;
        }
        
        .chart-container { 
            position: relative; 
            height: 350px; 
            width: 100%;
        }
        
        .risk-indicator {
            position: relative;
            overflow: hidden;
        }
        
        .risk-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }
        
        .risk-high::before { background: #dc2626; }
        .risk-medium::before { background: #d97706; }
        .risk-low::before { background: #16a34a; }
        
        .nav-active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .tab-active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal.active { display: flex; }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            min-width: 300px;
            max-width: 400px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .notification.success {
            background: #10b981;
            color: white;
        }
        
        .notification.error {
            background: #ef4444;
            color: white;
        }
        
        .notification.warning {
            background: #f59e0b;
            color: white;
        }
        
        .loading-pulse { 
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; 
        }
        
        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: .5; } 
        }
    </style>
</head>
<body class="bg-clinical-bg text-clinical-text">
    <!-- Navigation -->
    <nav class="bg-clinical-surface border-b border-clinical-border sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center h-16 px-4">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg flex items-center justify-center shadow-sm">
                            <i class="fas fa-heartbeat text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-semibold text-clinical-text">AyuAI</h1>
                            <p class="text-xs text-clinical-muted font-medium">Clinical Risk Assessment Platform</p>
                        </div>
                    </div>
                </div>
                
                <div class="hidden lg:flex items-center space-x-1">
                    <a href="#dashboard" class="nav-link px-4 py-2 text-sm font-medium text-gray-700 hover:text-primary-600 rounded-lg transition-colors">Dashboard</a>
                    <a href="#analytics" class="nav-link px-4 py-2 text-sm font-medium text-gray-700 hover:text-primary-600 rounded-lg transition-colors">Analytics</a>
                    <a href="#patients" class="nav-link px-4 py-2 text-sm font-medium text-gray-700 hover:text-primary-600 rounded-lg transition-colors">Patients</a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span class="text-sm text-clinical-muted">System Online</span>
                    </div>
                    <div class="text-sm text-clinical-muted">
                        <div class="font-medium">Dr. Utkarsh Dhagat</div>
                        <div class="text-xs">Attending Physician</div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Application -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Dashboard Header -->
        <section class="mb-8">
            <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm">
                <div class="p-6">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                        <div class="mb-4 lg:mb-0">
                            <h2 class="text-2xl font-semibold text-clinical-text mb-2">Patient Risk Assessment Dashboard</h2>
                            <p class="text-clinical-muted">AI-powered 90-day deterioration risk prediction using ensemble learning models</p>
                            <div class="flex items-center mt-3 space-x-6 text-sm">
                                <div class="flex items-center space-x-2">
                                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                    <span>Models Active</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-clock text-clinical-muted"></i>
                                    <span>Last Update: <span id="lastUpdateTime">--</span></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-users text-clinical-muted"></i>
                                    <span>Monitoring: <span id="totalPatients">0</span> patients</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <label for="modelSelector" class="text-sm font-medium text-clinical-muted">Model:</label>
                                <select id="modelSelector" class="border border-clinical-border rounded-lg px-3 py-2 text-sm bg-clinical-surface focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                                    <option value="ensemble">Ensemble (XGB+LSTM+RF)</option>
                                    <option value="xgboost">XGBoost</option>
                                    <option value="lstm">LSTM Network</option>
                                    <option value="random_forest">Random Forest</option>
                                    <option value="adaboost">AdaBoost</option>
                                </select>
                            </div>
                            <button id="refreshBtn" class="bg-primary-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors flex items-center space-x-2">
                                <i class="fas fa-sync-alt"></i>
                                <span>Refresh</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Grid -->
        <section id="dashboard" class="grid grid-cols-1 xl:grid-cols-12 gap-6 mb-8">
            <!-- Statistics Overview -->
            <div class="xl:col-span-12">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-clinical-muted">High Risk Patients</p>
                                <p class="text-3xl font-bold text-red-600" id="highRiskCount">0</p>
                                <p class="text-sm text-clinical-muted mt-1">
                                    <span class="text-red-600" id="highRiskChange">+0</span> from yesterday
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-red-50 rounded-full flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-600"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-clinical-muted">Medium Risk</p>
                                <p class="text-3xl font-bold text-yellow-600" id="mediumRiskCount">0</p>
                                <p class="text-sm text-clinical-muted mt-1">
                                    <span class="text-yellow-600" id="mediumRiskChange">+0</span> from yesterday
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-50 rounded-full flex items-center justify-center">
                                <i class="fas fa-exclamation-circle text-yellow-600"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-clinical-muted">Low Risk</p>
                                <p class="text-3xl font-bold text-green-600" id="lowRiskCount">0</p>
                                <p class="text-sm text-clinical-muted mt-1">
                                    <span class="text-green-600" id="lowRiskChange">+0</span> from yesterday
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-green-50 rounded-full flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-clinical-muted">Model Accuracy</p>
                                <p class="text-3xl font-bold text-primary-600" id="modelAccuracy">--</p>
                                <p class="text-sm text-clinical-muted mt-1">
                                    AUROC Score
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-primary-50 rounded-full flex items-center justify-center">
                                <i class="fas fa-brain text-primary-600"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patient Cohort List -->
            <div class="xl:col-span-5">
                <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm h-full">
                    <div class="p-4 border-b border-clinical-border">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-clinical-text">Patient Cohort</h3>
                            <div class="flex items-center space-x-2">
                                <button id="filterHighRisk" class="px-3 py-1 text-xs font-medium rounded-full border border-red-200 text-red-700 hover:bg-red-50 transition-colors">
                                    High Risk
                                </button>
                                <button id="filterAll" class="px-3 py-1 text-xs font-medium rounded-full bg-primary-600 text-white">
                                    All
                                </button>
                            </div>
                        </div>
                        <div class="mt-3">
                            <input type="text" id="patientSearch" placeholder="Search patients..." 
                                   class="w-full px-3 py-2 text-sm border border-clinical-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                        </div>
                    </div>
                    <div class="h-96 overflow-y-auto" id="patientList">
                        <!-- Patient list will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Patient Details Panel -->
            <div class="xl:col-span-7">
                <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm h-full">
                    <div class="p-4 border-b border-clinical-border">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-clinical-text">Patient Analysis</h3>
                                <div id="selectedPatientInfo" class="text-sm text-clinical-muted mt-1">
                                    Select a patient to view detailed analysis
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="aiAssistantBtn" class="px-3 py-2 text-xs font-medium bg-primary-50 text-primary-700 rounded-lg hover:bg-primary-100 transition-colors flex items-center space-x-2">
                                    <i class="fas fa-robot"></i>
                                    <span>AI Assistant</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabs Navigation -->
                    <div class="border-b border-clinical-border">
                        <nav class="flex space-x-8 px-4" role="tablist">
                            <button class="tab-btn tab-active py-3 px-1 border-b-2 border-primary-600 text-primary-600 font-medium text-sm" data-tab="overview">
                                Overview
                            </button>
                            <button class="tab-btn py-3 px-1 border-b-2 border-transparent text-clinical-muted font-medium text-sm hover:text-clinical-text" data-tab="timeline">
                                Risk Timeline
                            </button>
                            <button class="tab-btn py-3 px-1 border-b-2 border-transparent text-clinical-muted font-medium text-sm hover:text-clinical-text" data-tab="factors">
                                SHAP Analysis
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="p-6 overflow-y-auto" style="height: 500px;" id="tabContent">
                        <div class="text-center text-clinical-muted py-12">
                            <i class="fas fa-user-circle text-4xl mb-4"></i>
                            <p>Select a patient from the list to view detailed analysis</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="mb-8">
            <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-clinical-text">Model Performance Analytics</h3>
                            <p class="text-sm text-clinical-muted">Comprehensive evaluation metrics and validation results</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Performance Metrics -->
                        <div class="lg:col-span-1">
                            <h4 class="text-sm font-semibold text-clinical-text mb-4">Performance Metrics</h4>
                            <div class="chart-container">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Feature Importance -->
                        <div class="lg:col-span-1">
                            <h4 class="text-sm font-semibold text-clinical-text mb-4">Feature Importance</h4>
                            <div class="chart-container">
                                <canvas id="featureChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Patient Registration -->
        <section id="patients" class="mb-8">
            <div class="bg-clinical-surface rounded-lg border border-clinical-border shadow-sm">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-clinical-text">Patient Registration & Management</h3>
                            <p class="text-sm text-clinical-muted">Add new patients to the risk monitoring system</p>
                        </div>
                    </div>
                    
                    <form id="patientRegistrationForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Personal Information -->
                        <div class="space-y-4">
                            <h4 class="font-medium text-clinical-text">Personal Information</h4>
                            
                            <div>
                                <label class="block text-sm font-medium text-clinical-text mb-2">
                                    Patient ID <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="patientId" id="patientId" required readonly
                                       class="w-full px-3 py-2 border border-clinical-border rounded-lg bg-gray-50"
                                       placeholder="Auto-generated">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-clinical-text mb-2">
                                    Full Name <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="fullName" required
                                       class="w-full px-3 py-2 border border-clinical-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-clinical-text mb-2">
                                        Age <span class="text-red-500">*</span>
                                    </label>
                                    <input type="number" name="age" min="1" max="120" required
                                           class="w-full px-3 py-2 border border-clinical-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-clinical-text mb-2">Gender</label>
                                    <select name="gender" class="w-full px-3 py-2 border border-clinical-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select</option>
                                        <option value="M">Male</option>
                                        <option value="F">Female</option>
                                        <option value="O">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Clinical Information -->
                        <div class="space-y-4">
                            <h4 class="font-medium text-clinical-text">Clinical Information</h4>
                            
                            <div>
                                <label class="block text-sm font-medium text-clinical-text mb-2">
                                    Primary Condition <span class="text-red-500">*</span>
                                </label>
                                <select name="primaryCondition" required
                                        class="w-full px-3 py-2 border border-clinical-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select primary condition</option>
                                    <option value="type2_diabetes">Type 2 Diabetes Mellitus</option>
                                    <option value="heart_failure">Congestive Heart Failure</option>
                                    <option value="copd">Chronic Obstructive Pulmonary Disease</option>
                                    <option value="hypertension">Essential Hypertension</option>
                                    <option value="ckd">Chronic Kidney Disease</option>
                                    <option value="obesity">Obesity (BMI ≥30)</option>
                                    <option value="stroke_history">Cerebrovascular Disease</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-clinical-text mb-2">Attending Physician</label>
                                <select name="attendingPhysician"
                                        class="w-full px-3 py-2 border border-clinical-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select physician</option>
                                    <option value="Dr. Sarah Chen">Dr. Utkarsh Dhagat</option>
                                    <option value="Dr. Robert Martinez">Dr. Robert Martinez</option>
                                    <option value="Dr. Emily Johnson">Dr. Emily Johnson</option>
                                    <option value="Dr. Amit Patel">Dr. Amit Patel</option>
                                    <option value="Dr. Lisa Wilson">Dr. Lisa Wilson</option>
                                    <option value="Dr. Michelle Lee">Dr. Michelle Lee</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Additional Information -->
                        <div class="space-y-4">
                            <h4 class="font-medium text-clinical-text">Additional Information</h4>
                            
                            <div>
                                <label class="block text-sm font-medium text-clinical-text mb-2">Monitoring Parameters</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" name="monitoring" value="vitals" checked class="rounded text-primary-600">
                                        <span class="text-sm">Vital Signs</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" name="monitoring" value="labs" checked class="rounded text-primary-600">
                                        <span class="text-sm">Laboratory Values</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" name="monitoring" value="medications" checked class="rounded text-primary-600">
                                        <span class="text-sm">Medication Adherence</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" name="monitoring" value="lifestyle" class="rounded text-primary-600">
                                        <span class="text-sm">Lifestyle Factors</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-clinical-text mb-2">Medical History & Notes</label>
                                <textarea name="medicalHistory" rows="4"
                                          class="w-full px-3 py-2 border border-clinical-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                          placeholder="Enter relevant medical history, current medications, allergies, and other important clinical notes..."></textarea>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="md:col-span-2 lg:col-span-3 pt-4 border-t border-clinical-border">
                            <div class="flex items-center justify-between">
                                <div class="text-sm text-clinical-muted">
                                    <span class="text-red-500">*</span> Required fields
                                </div>
                                <div class="flex items-center space-x-3">
                                    <button type="submit" class="bg-primary-600 text-white px-6 py-2 rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors flex items-center space-x-2">
                                        <i class="fas fa-plus"></i>
                                        <span>Register Patient</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                    
                    <div id="registrationMessage" class="mt-6 hidden"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- AI Assistant Modal -->
    <div id="aiAssistantModal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-clinical-border">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-robot text-primary-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-clinical-text">AI Clinical Assistant</h3>
                            <p class="text-sm text-clinical-muted">Powered by MCP + Ollama</p>
                        </div>
                    </div>
                    <button id="closeAiModal" class="text-clinical-muted hover:text-clinical-text">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="h-96 overflow-y-auto p-6 space-y-4" id="chatMessages">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-primary-600 text-sm"></i>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 max-w-md">
                        <p class="text-sm">Hello! I'm your AI clinical assistant. I can help explain patient risk factors, suggest interventions, and provide clinical insights based on the current data. What would you like to know?</p>
                    </div>
                </div>
            </div>
            
            <div class="p-6 border-t border-clinical-border">
                <div class="flex space-x-3">
                    <input type="text" id="chatInput" placeholder="Ask about patient risk factors, interventions, or clinical insights..." 
                           class="flex-1 px-3 py-2 border border-clinical-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <button id="sendMessage" class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notifications" class="fixed top-20 right-4 z-50 space-y-3"></div>

    <script>
        // Clinical Dashboard Application
        class ClinicalDashboard {
            constructor() {
                // Pre-loaded patients data
                this.patients = [
                    {
                        id: "PT-0001",
                        name: "Ayushi Routh",
                        age: 65,
                        gender: "F",
                        condition: "type2_diabetes",
                        riskScore: 82,
                        confidence: 90,
                        admissionDate: "2025-06-15",
                        lastUpdate: "2025-09-10T00:10:00",
                        riskCategory: "high",
                        monitoringParameters: ["vitals", "labs", "medications"],
                        notes: "Patient with well-controlled diabetes, recent HbA1c trending upward.",
                        attendingPhysician: "Dr. Sarah Chen"
                    },
                    {
                        id: "PT-0002",
                        name: "Sarabjot Singh",
                        age: 72,
                        gender: "M",
                        condition: "heart_failure",
                        riskScore: 88,
                        confidence: 95,
                        admissionDate: "2025-05-22",
                        lastUpdate: "2025-09-10T00:15:00",
                        riskCategory: "high",
                        monitoringParameters: ["vitals", "labs", "medications", "lifestyle"],
                        notes: "Heart failure patient with recent weight gain and increased dyspnea.",
                        attendingPhysician: "Dr. Robert Martinez"
                    },
                    {
                        id: "PT-0003",
                        name: "Shraddha kapoor",
                        age: 58,
                        gender: "F",
                        condition: "copd",
                        riskScore: 70,
                        confidence: 85,
                        admissionDate: "2025-07-01",
                        lastUpdate: "2025-09-10T00:12:00",
                        riskCategory: "medium",
                        monitoringParameters: ["vitals", "labs"],
                        notes: "COPD patient with baseline oxygen therapy.",
                        attendingPhysician: "Dr. Emily Johnson"
                    },
                    {
                        id: "PT-0004",
                        name: "Kedar Shinde",
                        age: 45,
                        gender: "M",
                        condition: "hypertension",
                        riskScore: 55,
                        confidence: 80,
                        admissionDate: "2025-08-10",
                        lastUpdate: "2025-09-10T00:18:00",
                        riskCategory: "medium",
                        monitoringParameters: ["vitals", "medications"],
                        notes: "Hypertension controlled with medications.",
                        attendingPhysician: "Dr. Amit Patel"
                    },
                    {
                        id: "PT-0005",
                        name: "Katrina kaif",
                        age: 62,
                        gender: "F",
                        condition: "ckd",
                        riskScore: 73,
                        confidence: 88,
                        admissionDate: "2025-05-28",
                        lastUpdate: "2025-09-10T00:20:00",
                        riskCategory: "medium",
                        monitoringParameters: ["labs", "medications"],
                        notes: "Chronic kidney disease stage 3.",
                        attendingPhysician: "Dr. Lisa Wilson"
                    },
                    {
                        id: "PT-0006",
                        name: "Anushka Sharma",
                        age: 50,
                        gender: "F",
                        condition: "obesity",
                        riskScore: 40,
                        confidence: 75,
                        admissionDate: "2025-06-17",
                        lastUpdate: "2025-09-10T00:22:00",
                        riskCategory: "low",
                        monitoringParameters: ["lifestyle"],
                        notes: "Obesity with lifestyle interventions advised.",
                        attendingPhysician: "Dr. Michelle Lee"
                    },
                    {
                        id: "PT-0007",
                        name: "Tanmay Dwivedi",
                        age: 68,
                        gender: "M",
                        condition: "stroke_history",
                        riskScore: 80,
                        confidence: 90,
                        admissionDate: "2025-07-31",
                        lastUpdate: "2025-09-10T00:25:00",
                        riskCategory: "high",
                        monitoringParameters: ["vitals", "labs", "medications"],
                        notes: "Post-stroke patient with moderate disability.",
                        attendingPhysician: "Dr. Nicole Anderson"
                    }
                ];
                
                this.selectedPatient = null;
                this.currentTab = 'overview';
                this.currentFilter = 'all';
                this.searchTerm = '';
                this.charts = {};
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.generatePatientData();
                this.initializeCharts();
                this.renderDashboard();
                this.updateLastUpdateTime();
                this.generateNewPatientId();
            }
            
            generatePatientData() {
                // Generate additional data for each patient
                this.patients.forEach(patient => {
                    patient.vitalsHistory = this.generateVitalsHistory();
                    patient.riskTimeline = this.generateRiskTimeline(patient.riskScore);
                    patient.shapValues = this.generateShapValues(patient.condition, patient.riskScore);
                });
            }
            
            generateVitalsHistory() {
                const history = [];
                for (let i = 0; i < 30; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - (30 - i));
                    
                    history.push({
                        date: date.toISOString().split('T')[0],
                        heartRate: Math.floor(Math.random() * 40) + 60,
                        bloodPressure: {
                            systolic: Math.floor(Math.random() * 40) + 120,
                            diastolic: Math.floor(Math.random() * 20) + 70
                        },
                        temperature: (Math.random() * 2 + 97).toFixed(1),
                        oxygenSat: Math.floor(Math.random() * 5) + 95
                    });
                }
                return history;
            }
            
            generateRiskTimeline(currentRisk) {
                const timeline = [];
                for (let i = 0; i < 90; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() + i);
                    
                    let risk = currentRisk + (i * (currentRisk > 70 ? 0.1 : -0.05)) + (Math.random() - 0.5) * 10;
                    risk = Math.max(0, Math.min(100, risk));
                    
                    timeline.push({
                        date: date.toISOString().split('T')[0],
                        risk: Math.round(risk)
                    });
                }
                return timeline;
            }
            
            generateShapValues(condition, riskScore) {
                const features = [
                    'Lactate Levels',
                    'Respiratory Rate', 
                    'Age Factor',
                    'Blood Pressure',
                    'Heart Rate Variability',
                    'Oxygen Saturation',
                    'Temperature',
                    'Medication Adherence'
                ];
                
                return features.map(feature => {
                    const value = (Math.random() - 0.5) * (riskScore / 100);
                    return {
                        feature,
                        value: value.toFixed(3),
                        impact: value > 0 ? 'positive' : 'negative',
                        description: this.getFeatureDescription(feature, value)
                    };
                }).sort((a, b) => Math.abs(b.value) - Math.abs(a.value));
            }
            
            getFeatureDescription(feature, value) {
                const descriptions = {
                    'Lactate Levels': value > 0 ? 'Elevated lactate indicates metabolic stress' : 'Normal lactate levels',
                    'Respiratory Rate': value > 0 ? 'Increased respiratory rate suggests distress' : 'Stable breathing pattern',
                    'Age Factor': value > 0 ? 'Advanced age increases risk' : 'Age is protective factor',
                    'Blood Pressure': value > 0 ? 'Blood pressure elevation' : 'Well-controlled blood pressure',
                    'Heart Rate Variability': value > 0 ? 'Abnormal heart rate patterns' : 'Normal cardiac rhythm',
                    'Oxygen Saturation': value > 0 ? 'Concerning oxygen levels' : 'Good oxygen saturation',
                    'Temperature': value > 0 ? 'Temperature abnormalities' : 'Normal temperature',
                    'Medication Adherence': value > 0 ? 'Poor adherence patterns' : 'Good medication compliance'
                };
                return descriptions[feature] || 'Impact on patient risk';
            }
            
            setupEventListeners() {
                // Model selector
                document.getElementById('modelSelector').addEventListener('change', (e) => {
                    this.handleModelChange(e.target.value);
                });
                
                // Refresh button
                document.getElementById('refreshBtn').addEventListener('click', () => {
                    this.refreshData();
                });
                
                // Patient search
                document.getElementById('patientSearch').addEventListener('input', (e) => {
                    this.searchTerm = e.target.value;
                    this.renderPatientList();
                });
                
                // Filter buttons
                document.getElementById('filterAll').addEventListener('click', () => {
                    this.setFilter('all');
                });
                
                document.getElementById('filterHighRisk').addEventListener('click', () => {
                    this.setFilter('high');
                });
                
                // Tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });
                
                // Patient registration form
                document.getElementById('patientRegistrationForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handlePatientRegistration(e);
                });
                
                // AI Assistant
                document.getElementById('aiAssistantBtn').addEventListener('click', () => {
                    this.openAiAssistant();
                });
                
                document.getElementById('closeAiModal').addEventListener('click', () => {
                    this.closeAiAssistant();
                });
                
                document.getElementById('sendMessage').addEventListener('click', () => {
                    this.sendAiMessage();
                });
                
                document.getElementById('chatInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendAiMessage();
                    }
                });
                
                // Navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.scrollToSection(e.target.getAttribute('href'));
                    });
                });
            }
            
            renderDashboard() {
                this.updateStatistics();
                this.renderPatientList();
                
                if (this.patients.length > 0 && !this.selectedPatient) {
                    this.selectPatient(this.patients[0].id);
                }
            }
            
            updateStatistics() {
                const filteredPatients = this.getFilteredPatients();
                const highRisk = filteredPatients.filter(p => p.riskScore > 75);
                const mediumRisk = filteredPatients.filter(p => p.riskScore >= 40 && p.riskScore <= 75);
                const lowRisk = filteredPatients.filter(p => p.riskScore < 40);
                
                document.getElementById('highRiskCount').textContent = highRisk.length;
                document.getElementById('mediumRiskCount').textContent = mediumRisk.length;
                document.getElementById('lowRiskCount').textContent = lowRisk.length;
                document.getElementById('totalPatients').textContent = filteredPatients.length;
                
                // Mock changes
                document.getElementById('highRiskChange').textContent = '+1';
                document.getElementById('mediumRiskChange').textContent = '+2';
                document.getElementById('lowRiskChange').textContent = '+3';
                
                // Model accuracy
                document.getElementById('modelAccuracy').textContent = '0.82';
            }
            
            renderPatientList() {
                const container = document.getElementById('patientList');
                const patients = this.getFilteredPatients();
                
                if (patients.length === 0) {
                    container.innerHTML = `
                        <div class="p-8 text-center text-clinical-muted">
                            <i class="fas fa-search text-2xl mb-2"></i>
                            <p>No patients match current filters</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = patients.map(patient => {
                    const riskClass = this.getRiskClass(patient.riskScore);
                    const isSelected = this.selectedPatient?.id === patient.id;
                    
                    return `
                        <div class="patient-item risk-indicator ${riskClass.cssClass} p-4 border-b border-clinical-border cursor-pointer hover:bg-gray-50 transition-colors ${isSelected ? 'bg-blue-50' : ''}"
                             data-patient-id="${patient.id}">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-1">
                                        <h4 class="font-medium text-clinical-text">${patient.name}</h4>
                                        <div class="text-right">
                                            <div class="text-lg font-semibold ${riskClass.color}">${patient.riskScore}%</div>
                                            <div class="text-xs text-clinical-muted">${patient.confidence}% conf</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between text-sm text-clinical-muted">
                                        <div>
                                            <span>${this.formatCondition(patient.condition)} • Age ${patient.age} • ${patient.gender}</span>
                                        </div>
                                        <div class="text-xs">${this.formatDate(patient.lastUpdate)}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Add click handlers
                container.querySelectorAll('.patient-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const patientId = item.dataset.patientId;
                        this.selectPatient(patientId);
                    });
                });
            }
            
            selectPatient(patientId) {
                this.selectedPatient = this.patients.find(p => p.id === patientId);
                this.renderPatientList();
                this.renderPatientDetails();
                this.renderTabContent();
            }
            
            renderPatientDetails() {
                if (!this.selectedPatient) return;
                
                const patient = this.selectedPatient;
                const riskClass = this.getRiskClass(patient.riskScore);
                
                document.getElementById('selectedPatientInfo').innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="font-medium text-clinical-text">${patient.name}</span>
                            <span class="text-clinical-muted ml-2">ID: ${patient.id}</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-right">
                                <div class="text-2xl font-bold ${riskClass.color}">${patient.riskScore}%</div>
                                <div class="text-xs text-clinical-muted">${riskClass.label}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderTabContent() {
                const content = document.getElementById('tabContent');
                const patient = this.selectedPatient;
                
                if (!patient) {
                    content.innerHTML = `
                        <div class="text-center text-clinical-muted py-12">
                            <i class="fas fa-user-circle text-4xl mb-4"></i>
                            <p>Select a patient from the list to view detailed analysis</p>
                        </div>
                    `;
                    return;
                }
                
                switch (this.currentTab) {
                    case 'overview':
                        content.innerHTML = this.renderOverviewTab(patient);
                        break;
                    case 'timeline':
                        content.innerHTML = this.renderTimelineTab(patient);
                        setTimeout(() => this.renderTimelineChart(), 100);
                        break;
                    case 'factors':
                        content.innerHTML = this.renderFactorsTab(patient);
                        break;
                }
            }
            
            renderOverviewTab(patient) {
                const latestVitals = patient.vitalsHistory[patient.vitalsHistory.length - 1];
                
                return `
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-sm text-clinical-muted mb-1">Current Risk</div>
                                <div class="text-2xl font-bold text-primary-600">${patient.riskScore}%</div>
                                <div class="text-xs text-clinical-muted">Confidence: ${patient.confidence}%</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-sm text-clinical-muted mb-1">Condition</div>
                                <div class="text-lg font-semibold text-clinical-text">${this.formatCondition(patient.condition)}</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-sm text-clinical-muted mb-1">Attending</div>
                                <div class="text-lg font-semibold text-clinical-text">${patient.attendingPhysician}</div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h5 class="font-medium text-clinical-text mb-2 flex items-center">
                                <i class="fas fa-stethoscope text-blue-600 mr-2"></i>
                                Clinical Notes
                            </h5>
                            <p class="text-sm text-blue-800">${patient.notes}</p>
                        </div>
                        
                        <div>
                            <h5 class="font-medium text-clinical-text mb-3">Latest Vital Signs</h5>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <div class="text-xs text-clinical-muted">Heart Rate</div>
                                    <div class="text-lg font-semibold">${latestVitals.heartRate}</div>
                                    <div class="text-xs text-clinical-muted">BPM</div>
                                </div>
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <div class="text-xs text-clinical-muted">Blood Pressure</div>
                                    <div class="text-lg font-semibold">${latestVitals.bloodPressure.systolic}/${latestVitals.bloodPressure.diastolic}</div>
                                    <div class="text-xs text-clinical-muted">mmHg</div>
                                </div>
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <div class="text-xs text-clinical-muted">Temperature</div>
                                    <div class="text-lg font-semibold">${latestVitals.temperature}°</div>
                                    <div class="text-xs text-clinical-muted">Fahrenheit</div>
                                </div>
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <div class="text-xs text-clinical-muted">Oxygen Sat</div>
                                    <div class="text-lg font-semibold">${latestVitals.oxygenSat}%</div>
                                    <div class="text-xs text-clinical-muted">SpO2</div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h5 class="font-medium text-clinical-text mb-3">Top Risk Factors</h5>
                            <div class="space-y-2">
                                ${patient.shapValues.slice(0, 5).map(factor => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <span class="font-medium text-clinical-text">${factor.feature}</span>
                                            <p class="text-xs text-clinical-muted mt-1">${factor.description}</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-sm font-semibold ${factor.impact === 'positive' ? 'text-red-600' : 'text-green-600'}">
                                                ${factor.value > 0 ? '+' : ''}${factor.value}
                                            </span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderTimelineTab(patient) {
                return `
                    <div class="space-y-6">
                        <div>
                            <h5 class="font-medium text-clinical-text mb-2">90-Day Risk Prediction Timeline</h5>
                            <p class="text-sm text-clinical-muted mb-4">Predicted risk evolution based on current trends and clinical data</p>
                            <div class="chart-container">
                                <canvas id="patientTimelineChart"></canvas>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderFactorsTab(patient) {
                return `
                    <div class="space-y-6">
                        <div>
                            <h5 class="font-medium text-clinical-text mb-2">SHAP Feature Analysis</h5>
                            <p class="text-sm text-clinical-muted mb-4">Individual feature contributions to risk prediction with clinical explanations</p>
                        </div>
                        
                        <div class="space-y-4">
                            ${patient.shapValues.map(factor => `
                                <div class="border border-clinical-border rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <h6 class="font-medium text-clinical-text">${factor.feature}</h6>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-semibold ${factor.impact === 'positive' ? 'text-red-600' : 'text-green-600'}">
                                                ${factor.value > 0 ? '+' : ''}${factor.value}
                                            </span>
                                            <span class="text-xs px-2 py-1 rounded-full ${factor.impact === 'positive' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                                                ${factor.impact === 'positive' ? 'Increases Risk' : 'Decreases Risk'}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="h-6 bg-gray-200 rounded-full overflow-hidden">
                                            <div class="h-full ${factor.impact === 'positive' ? 'bg-red-500' : 'bg-green-500'}" 
                                                 style="width: ${Math.min(100, Math.abs(factor.value) * 200)}%; opacity: 0.7;"></div>
                                        </div>
                                    </div>
                                    
                                    <p class="text-sm text-clinical-muted">${factor.description}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            switchTab(tabName) {
                this.currentTab = tabName;
                
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (btn.dataset.tab === tabName) {
                        btn.classList.remove('border-transparent', 'text-clinical-muted');
                        btn.classList.add('border-primary-600', 'text-primary-600', 'tab-active');
                    } else {
                        btn.classList.remove('border-primary-600', 'text-primary-600', 'tab-active');
                        btn.classList.add('border-transparent', 'text-clinical-muted');
                    }
                });
                
                this.renderTabContent();
            }
            
            setFilter(filter) {
                this.currentFilter = filter;
                
                // Update filter buttons
                document.getElementById('filterAll').classList.remove('bg-primary-600', 'text-white');
                document.getElementById('filterAll').classList.add('border', 'border-gray-300', 'text-gray-700');
                
                document.getElementById('filterHighRisk').classList.remove('bg-primary-600', 'text-white');
                document.getElementById('filterHighRisk').classList.add('border', 'border-red-200', 'text-red-700');
                
                if (filter === 'all') {
                    document.getElementById('filterAll').classList.add('bg-primary-600', 'text-white');
                    document.getElementById('filterAll').classList.remove('border', 'border-gray-300', 'text-gray-700');
                } else if (filter === 'high') {
                    document.getElementById('filterHighRisk').classList.add('bg-primary-600', 'text-white');
                    document.getElementById('filterHighRisk').classList.remove('border', 'border-red-200', 'text-red-700');
                }
                
                this.renderPatientList();
            }
            
            getFilteredPatients() {
                let filtered = [...this.patients];
                
                // Filter by risk level
                if (this.currentFilter === 'high') {
                    filtered = filtered.filter(p => p.riskScore > 75);
                }
                
                // Filter by search term
                if (this.searchTerm) {
                    const search = this.searchTerm.toLowerCase();
                    filtered = filtered.filter(p => 
                        p.name.toLowerCase().includes(search) ||
                        p.id.toLowerCase().includes(search) ||
                        this.formatCondition(p.condition).toLowerCase().includes(search)
                    );
                }
                
                return filtered.sort((a, b) => b.riskScore - a.riskScore);
            }
            
            getRiskClass(riskScore) {
                if (riskScore > 75) {
                    return { label: 'High Risk', color: 'text-red-600', cssClass: 'risk-high' };
                } else if (riskScore >= 40) {
                    return { label: 'Medium Risk', color: 'text-yellow-600', cssClass: 'risk-medium' };
                } else {
                    return { label: 'Low Risk', color: 'text-green-600', cssClass: 'risk-low' };
                }
            }
            
            formatCondition(condition) {
                const conditionMap = {
                    'type2_diabetes': 'Type 2 Diabetes',
                    'heart_failure': 'Heart Failure',
                    'copd': 'COPD',
                    'hypertension': 'Hypertension',
                    'ckd': 'Chronic Kidney Disease',
                    'obesity': 'Obesity',
                    'stroke_history': 'Stroke History'
                };
                return conditionMap[condition] || condition;
            }
            
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            handleModelChange(model) {
                this.showNotification(`Switched to ${model} model. Recalculating predictions...`, 'success');
                // Simulate model change
                setTimeout(() => {
                    this.updateStatistics();
                }, 2000);
            }
            
            refreshData() {
                const btn = document.getElementById('refreshBtn');
                const icon = btn.querySelector('i');
                
                btn.disabled = true;
                icon.classList.add('loading-pulse');
                
                setTimeout(() => {
                    // Simulate refresh
                    this.updateLastUpdateTime();
                    this.updateStatistics();
                    this.renderPatientList();
                    
                    btn.disabled = false;
                    icon.classList.remove('loading-pulse');
                    
                    this.showNotification('Data refreshed successfully', 'success');
                }, 2000);
            }
            
            generateNewPatientId() {
                const nextId = String(this.patients.length + 1).padStart(4, '0');
                document.getElementById('patientId').value = `PT-${nextId}`;
            }
            
            handlePatientRegistration(e) {
                const formData = new FormData(e.target);
                const patientData = Object.fromEntries(formData);
                
                // Get monitoring parameters
                const monitoringParams = [];
                document.querySelectorAll('input[name="monitoring"]:checked').forEach(input => {
                    monitoringParams.push(input.value);
                });
                
                // Calculate initial risk score based on condition and age
                const riskScore = this.calculateInitialRisk(patientData);
                
                const newPatient = {
                    id: patientData.patientId,
                    name: patientData.fullName,
                    age: parseInt(patientData.age),
                    gender: patientData.gender || 'Not specified',
                    condition: patientData.primaryCondition,
                    riskScore,
                    confidence: Math.floor(Math.random() * 20) + 75,
                    admissionDate: new Date().toISOString().split('T')[0],
                    lastUpdate: new Date().toISOString(),
                    riskCategory: riskScore > 75 ? 'high' : riskScore > 40 ? 'medium' : 'low',
                    monitoringParameters: monitoringParams,
                    notes: patientData.medicalHistory || 'No additional notes provided.',
                    attendingPhysician: patientData.attendingPhysician || 'Not assigned',
                    vitalsHistory: this.generateVitalsHistory(),
                    riskTimeline: this.generateRiskTimeline(riskScore),
                    shapValues: this.generateShapValues(patientData.primaryCondition, riskScore)
                };
                
                this.patients.push(newPatient);
                this.renderDashboard();
                this.generateNewPatientId();
                
                // Show success message
                const messageEl = document.getElementById('registrationMessage');
                messageEl.className = 'mt-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800';
                messageEl.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-check-circle text-green-600"></i>
                        <span>Patient ${patientData.fullName} has been successfully registered for risk monitoring.</span>
                    </div>
                `;
                messageEl.classList.remove('hidden');
                
                // Clear form
                e.target.reset();
                this.generateNewPatientId();
                
                // Hide message after 5 seconds
                setTimeout(() => {
                    messageEl.classList.add('hidden');
                }, 5000);
                
                this.showNotification('Patient registered successfully', 'success');
            }
            
            calculateInitialRisk(patientData) {
                let baseRisk = 30;
                
                // Age factor
                const age = parseInt(patientData.age);
                if (age > 70) baseRisk += 30;
                else if (age > 60) baseRisk += 20;
                else if (age > 50) baseRisk += 10;
                
                // Condition factor
                const conditionRisk = {
                    'type2_diabetes': 15,
                    'heart_failure': 25,
                    'copd': 20,
                    'hypertension': 10,
                    'ckd': 20,
                    'obesity': 10,
                    'stroke_history': 25
                };
                
                baseRisk += conditionRisk[patientData.primaryCondition] || 10;
                
                return Math.min(100, Math.max(0, baseRisk + Math.floor(Math.random() * 20) - 10));
            }
            
            openAiAssistant() {
                document.getElementById('aiAssistantModal').classList.add('active');
                document.getElementById('chatInput').focus();
            }
            
            closeAiAssistant() {
                document.getElementById('aiAssistantModal').classList.remove('active');
            }
            
            sendAiMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (!message) return;
                
                const chatMessages = document.getElementById('chatMessages');
                
                // Add user message
                chatMessages.innerHTML += `
                    <div class="flex items-start space-x-3 justify-end">
                        <div class="bg-primary-600 text-white rounded-lg p-3 max-w-md">
                            <p class="text-sm">${message}</p>
                        </div>
                        <div class="w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user text-white text-sm"></i>
                        </div>
                    </div>
                `;
                
                input.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    const responses = [
                        "Based on the current patient data, I can see elevated risk factors that suggest close monitoring is needed.",
                        "The SHAP analysis indicates that respiratory patterns are the primary concern for this patient.",
                        "I recommend reviewing medication adherence patterns as they show significant impact on risk scores.",
                        "The ensemble model is showing high confidence in these predictions based on the temporal data patterns."
                    ];
                    
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    
                    chatMessages.innerHTML += `
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-robot text-primary-600 text-sm"></i>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-3 max-w-md">
                                <p class="text-sm">${response}</p>
                            </div>
                        </div>
                    `;
                    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            initializeCharts() {
                // Performance Chart
                const perfCtx = document.getElementById('performanceChart').getContext('2d');
                this.charts.performance = new Chart(perfCtx, {
                    type: 'bar',
                    data: {
                        labels: ['AUROC', 'AUPRC', 'Sensitivity', 'Specificity', 'PPV', 'NPV'],
                        datasets: [{
                            data: [0.82, 0.74, 0.85, 0.92, 0.78, 0.94],
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { min: 0, max: 1, title: { display: true, text: 'Score' } }
                        }
                    }
                });
                
                // Feature Importance Chart
                const featCtx = document.getElementById('featureChart').getContext('2d');
                this.charts.feature = new Chart(featCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Lactate', 'Resp Rate', 'Age', 'BP', 'HR', 'Oxygen', 'Temp', 'Meds'],
                        datasets: [{
                            data: [0.18, 0.16, 0.14, 0.12, 0.10, 0.09, 0.08, 0.07],
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { title: { display: true, text: 'Importance' } }
                        }
                    }
                });
            }
            
            renderTimelineChart() {
                const ctx = document.getElementById('patientTimelineChart');
                if (!ctx || !this.selectedPatient) return;
                
                if (this.charts.timeline) {
                    this.charts.timeline.destroy();
                }
                
                const timelineData = this.selectedPatient.riskTimeline.map(point => ({
                    x: point.date,
                    y: point.risk
                }));
                
                this.charts.timeline = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Risk Score',
                            data: timelineData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: {
                                type: 'time',
                                time: { displayFormats: { day: 'MMM d' } },
                                title: { display: true, text: 'Date' }
                            },
                            y: {
                                title: { display: true, text: 'Risk Score (%)' },
                                min: 0,
                                max: 100
                            }
                        }
                    }
                });
            }
            
            updateLastUpdateTime() {
                const now = new Date();
                document.getElementById('lastUpdateTime').textContent = now.toLocaleTimeString();
            }
            
            scrollToSection(href) {
                const target = document.querySelector(href);
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            }
            
            showNotification(message, type = 'success') {
                const container = document.getElementById('notifications');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                container.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 4000);
            }
        }
        
        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new ClinicalDashboard();
        });
    </script>
</body>
</html>
